<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie-edge">
  <title> Yeliz Dingler Database </title>
  <link rel="shortcut icon" href="#">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
  <link rel="stylesheet" href="./style.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" 
        integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
</head>
<body>
  <main>
    <form>
      <label for="firstName">Ad</label><br>
      <input type="text" name="firstName" id="firstName"><br>
      <label for="lastName">Soyad</label><br>
      <input type="text" name="lastName" id="lastName"><br>
      <label for="age">Yaş</label><br>
      <input type="number" name="age" id="age"><br>
      <label for="weight">Kilo</label><br>
      <input type="number" name="weight" id="weight"><br>
      <label for="height">Boy</label><br>
      <input type="number" name="height" id="height"><br>
      <label for="mail">Mail Adresi</label><br>
      <input type="text" name="mail" id="mail"><br>
      <label for="phone">Telefon</label><br>
      <input type="text" name="phone" id="phone"><br><br>
      
      <label for = "footInfo">Ayak</label><br>
      <input type="text" name="footInfo" id="footInfo"><br>
      <label for="kneeInfo">Diz</label><br>
      <input type="text" name="kneeInfo" id="kneeInfo"><br>
      <label for="hipInfo">Kalça</label><br>
      <input type="text" name="hipInfo" id="hipInfo"><br>
      <label for="chestInfo">Göğüs Kafesi</label><br>
      <input type="text" name="chestInfo" id="chestInfo"><br>
      <label for="earInfo">Kulak</label><br>
      <input type="text" name="earInfo" id="earInfo"><br><br>
       
      <label for = "healthHistory">Sağlık Geçmişi</label><br><br>
      <label for="surgeryInfo">Ameliyat Geçmişi</label><br>
      <input type="text" name="surgeryInfo" id="surgeryInfo"><br>
      <label for = "motherHealth">Anne</label><br>
      <input type="text" name="motherHealth" id="motherHealth"><br>
      <label for="fatherHealth">Baba</label><br>
      <input type="text" name="fatherHealth" id="fatherHealth"><br>
      <label for="momGrandMom">Anne Anne</label><br>
      <input type="text" name="momGrandMom" id="momGrandMom"><br>
      <label for="momGrandDad">Anne tarafı Dede</label><br>
      <input type="text" name="momGrandDad" id="momGrandDad"><br>
      <label for="dadGrandMom">Baba Anne</label><br>
      <input type="text" name="dadGrandMom" id="dadGrandMom"><br>
      <label for="dadGrandDad">Baba Tarafı Dede</label><br>
      <input type="text" name="dadGrandDad" id="dadGrandDad"><br><br><br>
        
      <label for = "eatHistory">Yeme İçme</label><br><br>
      <input type="text" name="eatHistory" id="eatHistory"><br><br>
      <label for = "sleepHistory">Uyku</label><br>
      <input type="text" name="sleepHistory" id="sleepHistory"><br>
      <label for="activityHistory">Aktivite</label><br>
      <input type="text" name="activityHistory" id="activityHistory"><br>
      <br><br>
   </form>    
          
    <form action="/action_page.php">
      <label for="img">Select image:</label>
      <input type="file" id="img" name="img" accept="image/*" multiple>
      <label id="uploadProgress"></label><br>
    </form>
    
    
     <form>
      <button id="addBtn" class="btn waves-effect waves-light">Add</button>
       <button id="selectBtn" class="btn waves-effect waves-light">Select Image</button>
      </form>

   
  <table id="studentTable" class="table table-borderless table-striped table-earning">
  <thead>
    <tr>
      <th>
        <button id="nameBtn" class="btn waves-effect waves-light">Name</button>  
      </th>
      <th>
        <button id="surnameBtn" class="btn waves-effect waves-light">Surname</button>  
        </th>
      <th>
        <button id="ageBtn" class="btn waves-effect waves-light">Age</button>  
      </th>
      <th>
        <button id="weightBtn" class="btn waves-effect waves-light">Weight</button>  
      </th>
      <th>
        <button id="heightBtn" class="btn waves-effect waves-light">Height</button>
      </th>
      <th>
        Mail</th>
      <th>
        Phone</th>
      <th>
        Foot</th>
      <th>
        Knee</th>
      <th>
        Hip</th>
      <th>Chest</th>
      <th>Ear</th>
      <th>Surgery</th>
      <th>Mum</th>
      <th>Dad</th>   
      <th>Grandma(Mum's)</th>
      <th>Grandpa(Mums's)</th>
      <th>Grandma(Dad's)</th>
      <th>Grandma(Dad's)</th>
      <th>EatingHabit</th>
      <th>SleepHabit</th>
      <th>Activity</th>
      <th>Images</th>
    </tr>
  </thead>
  <tbody id="testBody"></tbody>
  </table>
</main>
  
  
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<!-- The core Firebase JS SDK is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-storage.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-analytics.js"></script>
<link type="text/css " rel="stylesheet " href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.css " />
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js "></script>

<script>
 const firebaseConfig = {
  apiKey: "AIzaSyAGJJcvc9D_WRUCvfnaGbJPgTSEdzrfDSE",
  authDomain: "ace-tracker-306518.firebaseapp.com",
  databaseURL: "https://ace-tracker-306518-default-rtdb.firebaseio.com",
  projectId: "ace-tracker-306518",
  storageBucket: "ace-tracker-306518.appspot.com",
  messagingSenderId: "526755668636",
  appId: "1:526755668636:web:942fec5ac4cd04510f4359",
  measurementId: "G-Z3ZY5TSXHC"
};
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  
  const firstName = document.getElementById('firstName');
  const lastName = document.getElementById('lastName');
  const age = document.getElementById('age');
  const weight = document.getElementById('weight');
  const height = document.getElementById('height');
  const mail = document.getElementById('mail');
  const phone = document.getElementById('phone');
  
  const footInfo = document.getElementById('footInfo');
  const kneeInfo = document.getElementById('kneeInfo');
  const hipInfo = document.getElementById('hipInfo');
  const chestInfo = document.getElementById('chestInfo');
  const earInfo = document.getElementById('earInfo');
  
  
  const surgeryInfo = document.getElementById('surgeryInfo');
  const motherHealth = document.getElementById('motherHealth');
  const fatherHealth = document.getElementById('fatherHealth');
  const momGrandMom = document.getElementById('momGrandMom');
  const momGrandDad = document.getElementById('momGrandDad');
  const dadGrandMom = document.getElementById('dadGrandMom');
  const dadGrandDad = document.getElementById('dadGrandDad');
  
  const eatHistory = document.getElementById('eatHistory');
  const sleepHistory = document.getElementById('sleepHistory');
  const activityHistory = document.getElementById('activityHistory');
  
  const img = document.getElementById('img');
  
  const addBtn = document.getElementById('addBtn');
  
  const database = firebase.database();
  var students = database.ref('students');

  var imgName, imgUrl;
  var files = [];
  var reader;
  
   document.getElementById('selectImg').onClick = function(e){
     var input = document.createElement('input');
     input.type = 'file';
     
     input.onchange = e => {
       files = e.target.files;
       reader = new FileReader();
       //reader.onload = function(){
       //   imgUrl = reader.result;
       //}
       reader.readAsDataURL(files[0]);
     }
     
     input.click();
   }

  nameBtn.addEventListener('click', function(e) {
    sortTable(0,false);
  });
  surnameBtn.addEventListener('click', function(e) {
    sortTable(1,false);
  });
  ageBtn.addEventListener('click', function(e) {
    sortTable(2,true);
  });
  weightBtn.addEventListener('click', function(e) {
    sortTable(3,true);
  });
  heightBtn.addEventListener('click', function(e) {
    sortTable(4,true);
  });

  addBtn.addEventListener('click', function(e) {
    var newStudentRef = students.push();
    newStudentRef.set({
      firstName: firstName.value,
      lastName: lastName.value,
      age: age.value,
      weight: weight.value,
      height: height.value,
      mail: mail.value,
      phone: phone.value,
      footInfo: footInfo.value,
      kneeInfo: kneeInfo.value,
      hipInfo: hipInfo.value,
      chestInfo: chestInfo.value,
      earInfo: earInfo.value,
      surgeryInfo: surgeryInfo.value,
      motherHealth: motherHealth.value,
      fatherHealth: fatherHealth.value,
      momGrandMom: momGrandMom.value,
      momGrandDad: momGrandDad.value,
      dadGrandMom: dadGrandMom.value,
      dadGrandDad: dadGrandDad.value,
      eatHistory: eatHistory.value,
      sleepHistory: sleepHistory.value,
      activityHistory: activityHistory.value
    });
    imgName = phone.value;
    var uploadTask = firebase.storage().ref('students/images'+imgName+".png").put(files[0]);
    
    uploadTask.on('state_change', function(snapshot){
      var progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
      document.getElementById('uploadProgress').innerHTML = 'Upload ' + progress + '%';
    },
    function(error){
      alert('error in saving the image');
    },
    function(){
      uploadTask.snapshot.ref.getDownloadURL().then(function(url){
        imgUrl = url;
        
        database.ref('Pictures/'+imgName).set({
          name: imgName,
          link: imgUrl
        });
        alert('image added successfully');
    
      });
      
    });
  });
  
  
  
  function loadTableData(item) {
    const table = document.getElementById("testBody");
    
      let row = table.insertRow();
      
      let firstName = row.insertCell(0);
      firstName.innerHTML = item.firstName;
      let lastName = row.insertCell(1);
      lastName.innerHTML = item.lastName;
      let age = row.insertCell(2);
      age.innerHTML = item.age;
      let weight = row.insertCell(3);
      weight.innerHTML = item.weight;
      let height = row.insertCell(4);
      height.innerHTML = item.height;
      let mail = row.insertCell(5);
      mail.innerHTML = item.mail;
      let phone = row.insertCell(6);
      phone.innerHTML = item.phone;
      let footInfo = row.insertCell(7);
      footInfo.innerHTML = item.footInfo;
      let kneeInfo = row.insertCell(8);
      kneeInfo.innerHTML = item.kneeInfo;
      let hipInfo = row.insertCell(9);
      hipInfo.innerHTML = item.hipInfo;
      let chestInfo = row.insertCell(10);
      chestInfo.innerHTML = item.chestInfo;
      let earInfo = row.insertCell(11);
      earInfo.innerHTML = item.earInfo;
      let surgeryInfo = row.insertCell(12);
      surgeryInfo.innerHTML = item.surgeryInfo;
      let motherHealth = row.insertCell(13);
      motherHealth.innerHTML = item.motherHealth;
      let fatherHealth = row.insertCell(14);
      fatherHealth.innerHTML = item.fatherHealth;
      let momGrandMom = row.insertCell(15);
      momGrandMom.innerHTML = item.momGrandMom;
      let momGrandDad = row.insertCell(16);
      momGrandDad.innerHTML = item.momGrandDad;
      let dadGrandMom = row.insertCell(17);
      dadGrandMom.innerHTML = item.dadGrandMom;
      let dadGrandDad = row.insertCell(18);
      dadGrandDad.innerHTML = item.dadGrandDad;
      let eatHistory = row.insertCell(19);
      eatHistory.innerHTML = item.eatHistory;
      let sleepHistory = row.insertCell(20);
      sleepHistory.innerHTML = item.sleepHistory;
      let activityHistory = row.insertCell(21);
      activityHistory.innerHTML = item.activityHistory;
      let images = row.insertCell(22);
      images.innerHTML = "<button id='btnEdit';>Photos</button>";
  }
  
  
  // Attach an asynchronous callback to read the data at our posts reference
  students.on("child_added", function(snapshot) {
    databaseItems=snapshot.val();
    loadTableData( databaseItems);
  }, function (errorObject) {
    console.log("The read failed: " + errorObject.code);
  });

  
 function sortTable(n,isNumber) {
  var table, rows, switching, i, x, y, shouldSwitch, dir, switchcount = 0;
  table = document.getElementById("testBody");
  switching = true;
  // Set the sorting direction to ascending:
  dir = "asc"; 
  /* Make a loop that will continue until
  no switching has been done: */
  while (switching) {
    // Start by saying: no switching is done:
    switching = false;
    rows = table.rows;
    /* Loop through all table rows (except the
    first, which contains table headers): */
    for (i = 0; i < (rows.length - 1); i++) {
      // Start by saying there should be no switching:
      shouldSwitch = false;
      /* Get the two elements you want to compare,
      one from current row and one from the next: */
      x = rows[i].getElementsByTagName("TD")[n];
      y = rows[i + 1].getElementsByTagName("TD")[n];
      /* Check if the two rows should switch place,
      based on the direction, asc or desc: */
      if (dir == "asc") {
        if(!isNumber){
          if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
            // If so, mark as a switch and break the loop:
            shouldSwitch = true;
            break;
          }
        }else{
          if (Number(x.innerHTML) > Number(y.innerHTML)) {
            shouldSwitch = true;
            break;
          }
        }
      } else if (dir == "desc") {
        if(!isNumber){
          if (x.innerHTML.toLowerCase() < y.innerHTML.toLowerCase()) {
            // If so, mark as a switch and break the loop:
            shouldSwitch = true;
            break;
          }
        }else{
          if (Number(x.innerHTML) < Number(y.innerHTML)) {
            shouldSwitch = true;
            break;
          }
        }
      }
    }
    if (shouldSwitch) {
      /* If a switch has been marked, make the switch
      and mark that a switch has been done: */
      rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
      switching = true;
      // Each time a switch is done, increase this count by 1:
      switchcount ++; 
    } else {
      /* If no switching has been done AND the direction is "asc",
      set the direction to "desc" and run the while loop again. */
      if (switchcount == 0 && dir == "asc") {
        dir = "desc";
        switching = true;
      }
    }
  }
}
  
  </script>
</body>
</html>
